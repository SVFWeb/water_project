<view class="machineTopBox">
  <image src="/image/back.png" mode="scaleToFill" bind:tap="backTab" class="machineBack"/>
  <view class="machineTop-titleBox">
    <view class="machineTop-title">
      <text>广西民族大学武鸣校区加水站</text>
      <view class="machineTop-title-number">
        <text class="machineTop-title-number-one">加水机:</text>
        <text class="machineTop-title-number-two">{{machineNum}}号</text>
      </view>
    </view>
    <image src="/image/water-bg.png" mode=""/>
  </view>
</view>
<view class="machineInfoBox">
  <view class="machineInfo-titleBox">
    <text>加水价格:</text>
    <view class="machineInfo-water-priceBox">
      <text class="machineInfo-water-price-one">{{rate_sum}}</text>
      <text class="machineInfo-water-price-two">水费{{price_per_liter}}元/升，服务费{{service_fee}}元/升</text>
    </view>
  </view>
  <view class="machineInfo-userbalanceBox">
    <view class="machineInfo-userbalance">
      <image src="/image/user-balance.png" mode="scaleToFill"/>
      <view class="machineInfo-userbalance-title">
        <text class="machineInfo-userbalance-title-one">当前余额</text>
        <text class="machineInfo-userbalance-title-two">{{userBalance}}</text>
      </view>
    </view>
    <view class="machineInfo-userbalance">
      <image src="/image/shuidi.png" mode="scaleToFill"/>
      <view class="machineInfo-userbalance-title">
        <text class="machineInfo-userbalance-title-one">可加水升数</text>
        <text class="machineInfo-userbalance-title-two-water">{{water_yield}}</text>
      </view>
    </view>
  </view>
  <view class="machineInfo-detailsBox">
    <view class="machineInfo-details-title">
      <text>机器详情</text>
    </view>
    <view class="machineInfo-details-contentBox">
      <view class="machineInfo-details-content">
        <image src="/image/wifi.png" mode=""/>
        <text>在线情况</text>
      </view>
      <text>{{machine_status}}</text>
    </view>
    <view class="machineInfo-details-contentBox">
      <view class="machineInfo-details-content">
        <image src="/image/id.png" mode=""/>
        <text>设备编号</text>
      </view>
      <text>{{machine_id}}</text>
    </view>
    <view class="machineInfo-details-contentBox">
      <view class="machineInfo-details-content">
        <image src="/image/wendu.png" mode=""/>
        <text>设备温度</text>
      </view>
      <text>{{device_temperature}}℃</text>
    </view>
    <view class="machineInfo-details-contentBox">
      <view class="machineInfo-details-content">
        <image src="/image/dianchi.png" mode=""/>
        <text>电池电量</text>
      </view>
      <text>{{battery_level}}%</text>
    </view>
    <view class="machineInfo-details-contentBox">
      <view class="machineInfo-details-content">
        <image src="/image/speed.png" mode=""/>
        <text>加水速度</text>
      </view>
      <text>30升/分钟</text>
    </view>
    <view class="machineInfo-details-contentBox">
      <view class="machineInfo-details-content">
        <image src="/image/speed.png" mode=""/>
        <text>当前加水量</text>
      </view>
      <text>{{total_water_addition}}L</text>
    </view>
  </view>
  <view class="machineInfo-connectBox">
    <image src="/image/lianjie.png" mode=""/>
    <text class="machineInfo-connect-text-one">设备连接状态：</text>
    <text class="{{is_connect==0?'machineInfo-connect-text-two-no':'machineInfo-connect-text-two-yes'}}">{{is_connect==0?'未连接':'已连接'}}</text>
    <text class="connection-time-text" wx:if="{{is_connect==1}}">{{connectionTime}}</text>
  </view>
  <view class="machineStartIngBox-box">
    <view class="machineStartIngBox">
      <text class="machineStartIngBox-btn1"  bind:tap="connectedDevice">连接设备</text>
    </view>
    <view class="machineStartIngBox" bind:tap="startAddingWater" >
      <text class="machineStartIngBox-btn2">开始加水</text>
    </view>
    <view class="machineStartIngBox">
      <text class="machineStartIngBox-btn3" bind:tap="pauseDevice">暂停设备</text>
    </view>
    <view class="machineStartIngBox">
      <text class="machineStartIngBox-btn4" bind:tap="endAddingWater">结束加水</text>
    </view>
  </view>
</view>

<!-- 登录提示弹窗 -->
<view wx:if="{{showLoginModal}}" class="login-modal">
  <view class="modal-mask" bindtap="onCloseLoginModal"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">登录提示</text>
      <text class="modal-close" bindtap="onCloseLoginModal">×</text>
    </view>
    <view class="modal-body">
      <text class="login-tip-text">请先登录后才能使用设备控制功能</text>
    </view>
    <view class="modal-footer">
      <button class="btn-cancel" bindtap="onCloseLoginModal">取消</button>
      <button class="btn-confirm" bindtap="onConfirmLogin">去登录</button>
    </view>
  </view>
</view>
<!-- 余额不足弹窗 -->
<view wx:if="{{showBalanceModal}}" class="login-modal">
  <view class="modal-mask" bindtap="onCloseBalanceModal"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">余额不足</text>
      <text class="modal-close" bindtap="onCloseBalanceModal">×</text>
    </view>
    <view class="modal-body">
      <text class="login-tip-text">当前余额不足，请先充值</text>
      <text class="balance-text">当前余额: {{userBalance}}元</text>
    </view>
    <view class="modal-footer">
      <button class="btn-cancel" bindtap="onCloseBalanceModal">取消</button>
      <button class="btn-confirm" bindtap="onConfirmRecharge">去充值</button>
    </view>
  </view>
</view>